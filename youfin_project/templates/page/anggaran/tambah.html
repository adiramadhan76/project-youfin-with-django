{% extends 'page/base.html' %}
{% load static %}

{% block title %}Tambah Anggaran{% endblock %}

{% block your_content_here %}
<div class="overlap">
    <div class="content-card">
        <h1><i class="bi bi-wallet2" style="margin-right: 4px;"></i> Tambah Anggaran</h1>

        <!-- Pesan Alert -->
        <div class="message-box mt-3">
            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-dismissible fade show {% if message.tags == 'error' %}alert-danger{% else %}alert-success{% endif %}"
                role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
            {% endif %}
        
            {% if total_income == 0 %}
            <div class="alert alert-warning">
                Anda belum memiliki pemasukan. Meskipun demikian, Anda masih dapat menambahkan anggaran.
            </div>
            {% endif %}
        </div>

        {% if categories %}
        <form method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label class="my-3" for="category">Kategori Pengeluaran:</label>
                <select name="category" id="category" class="form-control" autofocus required>
                    <option value="">- Pilih Kategori Pengeluaran -</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label class="my-3" for="bulan">Bulan:</label>
                <select name="bulan" id="bulan" class="form-control" required>
                    {% for key, value in bulan_choices %}
                    <option value="{{ key }}" {% if key == bulan %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label class="my-3" for="tahun">Tahun:</label>
                <select name="tahun" id="tahun" class="form-control" required>
                    {% for year in years %}
                        <option value="{{ year }}">{{ year }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label class="my-3" for="initial_budget">Jumlah Anggaran:</label>
                <input type="number" 
                       min="0" 
                       step="0.01" 
                       placeholder="Masukan jumlah anggaran" 
                       autocomplete="off" 
                       name="initial_budget" 
                       id="initial_budget" 
                       class="form-control" 
                       required>
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-primary mt-3">Simpan</button>
                <a href="{% url 'youfin_app:anggaran' %}" class="btn btn-secondary mt-3 ms-2">Batal</a>
            </div>
        </form>
        {% else %}
        <div class="alert alert-warning mt-3" role="alert">
            Anda belum memiliki kategori pengeluaran, atau semua kategori pengeluaran sudah memiliki anggaran. Silakan
            tambahkan kategori pengeluaran baru jika diperlukan.
        </div>
        <div class="d-flex gap-2">
            <a href="{% url 'youfin_app:tambah_kategori' %}" class="btn btn-primary">Tambah Kategori Pengeluaran</a>
            <a href="{% url 'youfin_app:anggaran' %}" class="btn btn-secondary">Batal</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}