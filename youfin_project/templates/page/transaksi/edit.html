{% extends 'page/base.html' %}
{% load static %}

{% block title %}Edit Transaksi{% endblock %}

{% block your_content_here %}
<div class="overlap">
    <div class="content-card">
        <h1><i class="bi bi-cash-stack" style="margin-right: 4px;"></i> Edit Transaksi</h1>

        <form method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label class="my-3" for="name">Nama Transaksi</label>
                <input type="text" name="name" id="name" class="form-control" value="{{ transaction.name }}" autocomplete="off" autofocus placeholder="Masukan nama transaksi" required>
            </div>
            <div class="form-group">
                <label class="my-3" for="category">Kategori</label>
                <select name="category" id="category" class="form-control" required>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if category.id == transaction.category.id %}selected{% endif %} data-type="{{ category.category_type }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label class="my-3" for="transaction_type">Jenis Transaksi</label>
                <input type="text" name="transaction_type" id="transaction_type" class="form-control" value="{{ transaction.transaction_type }}" placeholder="Jenis transaksi akan otomatis terisi berdasarkan kategori yang dipilih" readonly>
            </div>
            <div class="form-group">
                <label class="my-3" for="amount">Nominal</label>
                <input type="number" min="0" autocomplete="off" name="amount" id="amount" class="form-control" value="{{ transaction.amount }}" placeholder="Masukan nominal transaksi" required>
            </div>
            <div class="form-group">
                <label class="my-3" for="date">Tanggal</label>
                <input type="date" name="date" id="date" class="form-control mb-3" value="{{ transaction.date|date:"Y-m-d" }}" required>
            </div>
            <button type="submit" class="btn btn-success">Update Transaksi</button>
            <a href="{% url 'youfin_app:transaksi' %}" class="btn btn-secondary">Batal</a>
        </form>
    </div>
</div>
{% endblock %}

{% block script_transaksi %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const categorySelect = document.getElementById("category");
        const transactionTypeInput = document.getElementById("transaction_type");

        // Function to update the transaction type based on selected category
        function updateTransactionType() {
            const selectedOption = categorySelect.options[categorySelect.selectedIndex];
            if (selectedOption) {
                const transactionType = selectedOption.getAttribute("data-type"); // Get data-type attribute
                transactionTypeInput.value = transactionType || ""; // Set input value or empty string
            }
        }

        // Initial update when the page loads
        updateTransactionType();

        // Event listener to update transaction type when category changes
        categorySelect.addEventListener("change", updateTransactionType);
    });
</script>
{% endblock %}
